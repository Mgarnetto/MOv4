@model MoozicOrb.API.Models.PostFeedViewModel

@if (Model.AllowPosting)
{
    <div class="create-post-card mb-4">
            <div class="create-post-header mb-2">
                <span class="text-muted small">Broadcast your signal...</span>
            </div>

            <form id="createPostForm" onsubmit="return false;">
                <input type="hidden" name="ContextType" value="@Model.ContextType" />
                <input type="hidden" name="ContextId" value="@Model.ContextId" />

                <div id="postTitleGroup" class="mb-3" style="display:none; animation: fadeIn 0.3s ease;">
                    <input type="text" id="postTitle"
                           class="form-control"
                           placeholder="Add a Title (Required for Audio)"
                           style="background:#050505; border:1px solid #333; color:white; font-weight:bold; border-left: 3px solid var(--accent-solar);">
                </div>

                <div class="d-flex gap-3">
                    <img src="/img/profile_default.jpg" class="rounded-circle border border-secondary" width="50" height="50" style="object-fit:cover;">
                    <textarea name="Content" id="postContent"
                              class="form-control create-post-input"
                              placeholder="Share a track, update, or thought..."
                              rows="2" style="min-height: 60px; resize: none;"></textarea>
                </div>

                <div id="mediaPreview" class="mt-3 d-none">
                </div>

                <div class="create-post-actions border-top border-secondary mt-3 pt-2">

                    <div class="d-flex gap-2">
                        <label class="post-action-btn" title="Upload Image">
                            <i class="fas fa-image text-success"></i>
                            <input type="file" name="fileImage" accept="image/*" hidden onchange="handleFileSelect(this, 'image')">
                        </label>

                        <label class="post-action-btn" title="Upload Video">
                            <i class="fas fa-video text-primary"></i>
                            <input type="file" name="fileVideo" accept="video/*" hidden onchange="handleFileSelect(this, 'video')">
                        </label>

                        <label class="post-action-btn" title="Upload Audio">
                            <i class="fas fa-music text-warning"></i>
                            <input type="file" name="fileAudio" accept=".mp3,.wav,.ogg,.m4a" hidden onchange="handleFileSelect(this, 'audio')">
                        </label>

                        <button type="button" class="post-action-btn" title="Add Link">
                            <i class="fas fa-link"></i>
                        </button>
                        <button type="button" class="post-action-btn" title="Location">
                            <i class="fas fa-map-marker-alt"></i>
                        </button>
                    </div>

                    <button type="submit" class="btn-post-submit">Post</button>
                </div>
            </form>
        </div>
}


<div id="feed-stream-container" class="feed-stream feed-wrapper">
    @if (Model.InitialPosts != null && Model.InitialPosts.Any())
    {
        @foreach (var post in Model.InitialPosts)
        {
            post.ViewerId = Model.ViewerId;
            <partial name="_PostCard" model="post" />
        }
    }
    else
    {
        <div class="text-center text-muted py-5" id="empty-feed-msg">
            <i class="fas fa-ghost fa-2x mb-3" style="opacity: 0.3;"></i>
            <p>It's quiet here... be the first to post!</p>
        </div>
    }
</div>